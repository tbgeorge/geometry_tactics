//=================================================================================
// CombatManager.cpp
// Author: Tyler George
// Date  : November 11, 2015
//=================================================================================

////===========================================================================================
///===========================================================================================
// Includes
///===========================================================================================
////===========================================================================================

#include "GameCode/CombatManager.hpp"
#include "GameCode/Entities/Actor.hpp"
#include "Engine/Utilities/StringTable.hpp"

////===========================================================================================
///===========================================================================================
// Static Variable Initialization
///===========================================================================================
////===========================================================================================

CombatManager CombatManager::s_theCombatManager;

////===========================================================================================
///===========================================================================================
// Constructors/Destructors
///===========================================================================================
////===========================================================================================

///---------------------------------------------------------------------------------
///
///---------------------------------------------------------------------------------
CombatManager::~CombatManager()
{

}

////===========================================================================================
///===========================================================================================
// Initialization
///===========================================================================================
////===========================================================================================


////===========================================================================================
///===========================================================================================
// Accessors/Queries
///===========================================================================================
////===========================================================================================

///---------------------------------------------------------------------------------
///
///---------------------------------------------------------------------------------
AttackResult CombatManager::PerformMeleeAttack( const AttackData& data )
{
    AttackResult result;
    result.damageDone = 0;
    result.didCrit = false;
    result.didHit = false;
    result.targetDied = false;

    if (!data.target)
        return result;

    bool hit = GetRandomFloatZeroToOne() <= data.chanceToHit ? true : false;
    result.didHit = hit;

    if (hit)
    {
        bool crit = GetRandomFloatZeroToOne() <= data.chanceToCrit ? true : false;
        result.didCrit = crit;

        int damageToApply = GetRandomValueInIntRangeInclusive( data.damageRange );
//         int armor = GetRandomValueInIntRangeInclusive( data.armorRange );
//         int armorMitigation = armor / 3;
// 
//         damageToApply -= armorMitigation;
        if (damageToApply <= 0)
            damageToApply = 0;

        if (crit)
            damageToApply *= 2;

        result.damageDone = damageToApply;

        bool targetDied = data.target->ApplyDamage( damageToApply );
        result.targetDied = targetDied;
    }

    return result;
}

////===========================================================================================
///===========================================================================================
// Mutators
///===========================================================================================
////===========================================================================================

////===========================================================================================
///===========================================================================================
// Update
///===========================================================================================
////===========================================================================================


////===========================================================================================
///===========================================================================================
// Render
///===========================================================================================
////===========================================================================================


////===========================================================================================
///===========================================================================================
// Private Functions
///===========================================================================================
////===========================================================================================

///---------------------------------------------------------------------------------
///
///---------------------------------------------------------------------------------
CombatManager::CombatManager()
{
}